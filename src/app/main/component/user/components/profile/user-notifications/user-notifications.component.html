<div class="container notification-wrapper" aria-label="user-notification">
  <h1 class="heading h5">{{ 'homepage.notifications.title' | translate }}</h1>
  <div class="filter-wrapper">
    <div class="filter-search-wrapper">
      <div class="filter-approach-wrapper">
        <span class="filter-header h6">{{ 'homepage.notifications.filter' | translate }}</span>
        <div class="filter-buttons filter-approach-buttons">
          <button
            *ngFor="let approach of filterApproaches"
            class="global-tag custom-chip"
            [ngClass]="{ 'global-tag-clicked': approach.isSelected }"
            (click)="changefilterApproach(approach.name, $event)"
            (keydown)="changefilterApproach(approach.name, $event)"
          >
            {{ getLangValue(approach.nameUa, approach.nameEn) }}
          </button>
        </div>
      </div>
      <input class="notification-search" type="text" placeholder="{{ 'search.search-all-results.placeholder' | translate }}" />
    </div>

    <div *ngIf="checkSelectedFilter(filterApproach.TYPE)" class="filter-buttons">
      <button
        *ngFor="let type of notificationTypesFilter"
        class="global-tag custom-chip"
        [ngClass]="{ 'global-tag-clicked': type.isSelected }"
        (click)="changeFilter(type, filterApproach.TYPE, $event)"
        (keydown)="changeFilter(type, filterApproach.TYPE, $event)"
        [disabled]="isFilterDisabled"
      >
        {{ getLangValue(type.nameUa, type.nameEn) }}
      </button>
    </div>

    <div *ngIf="checkSelectedFilter(filterApproach.ORIGIN)" class="filter-buttons">
      <button
        *ngFor="let project of projects"
        class="global-tag custom-chip"
        [ngClass]="{ 'global-tag-clicked': project.isSelected }"
        (click)="changeFilter(project, filterApproach.ORIGIN, $event)"
        (keydown)="changeFilter(project, filterApproach.ORIGIN, $event)"
        [disabled]="isFilterDisabled"
      >
        {{ project.nameEn }}
      </button>
    </div>
  </div>
  <div *ngIf="!isLoading && !notifications.length" class="no-notifications">
    <app-no-data [title]="'homepage.notifications.no-notifications'"></app-no-data>
  </div>
  <div *ngIf="notifications.length">
    <mat-accordion class="list-wrapper" multi="false" [togglePosition]="'before'">
      <mat-expansion-panel
        class="notification"
        *ngFor="let notification of notifications"
        [ngClass]="notification.viewed ? 'notification-read' : 'notification-unread'"
        (click)="readNotification($event, notification)"
        (keydown)="readNotification($event, notification)"
        hideToggle
      >
        <mat-expansion-panel-header class="notification-header">
          <div class="d-flex justify-content-between">
            <div class="d-flex flex-column">
              <div class="notification-header-project">
                {{ notification.projectName }}
              </div>
              <div class="notification-header-title body-1">
                {{ notification.titleText }}
              </div>
            </div>
            <div class="notific-right-column">
              <div class="notification-header-time body-2">
                {{ notification.time | localizedDate | date: 'MMM dd, yyyy hh:mm a' }}
              </div>
              <div class="d-flex justify-content-around">
                <button
                  class="notific-action-btn"
                  (click)="deleteNotification($event, notification)"
                  (keydown)="deleteNotification($event, notification)"
                >
                  <img [src]="deleteIcon" class="btn-img" aria-hidden="true" alt="delete icon" />
                  <span class="d-none d-sm-block btn-text">{{ 'homepage.notifications.delete' | translate }}</span>
                </button>

                <button
                  *ngIf="notification.viewed"
                  class="notific-action-btn"
                  (click)="unReadNotification($event, notification)"
                  (keydown)="unReadNotification($event, notification)"
                >
                  <span
                    class="material-icons"
                    style="color: rgb(128, 128, 128)"
                    ngbPopover="{{ 'homepage.notifications.mark-as-unread' | translate }}"
                    triggers="mouseenter:mouseleave"
                    placement="left"
                    >{{ 'mark_as_unread' }}</span
                  >
                  <span class="d-none d-sm-block">{{ 'homepage.notifications.mark-as-unread' | translate }}</span>
                </button>

                <button
                  *ngIf="!notification.viewed"
                  class="notific-action-btn"
                  (click)="readNotification($event, notification)"
                  (keydown)="readNotification($event, notification)"
                >
                  <span
                    class="material-icons"
                    style="color: rgb(128, 128, 128)"
                    ngbPopover="{{ 'homepage.notifications.mark-as-read' | translate }}"
                    triggers="mouseenter:mouseleave"
                    placement="left"
                    >{{ 'mark_email_read' }}</span
                  >
                  <span class="d-none d-sm-block">{{ 'homepage.notifications.mark-as-read' | translate }}</span>
                </button>
              </div>
            </div>
          </div>
        </mat-expansion-panel-header>
        <p appNotificContentReplace [replacements]="notification"></p>
        <div class="friend-action-button" *ngIf="notification.notificationType === notificationFriendRequest">
          <button (click)="declineRequest(notification.actionUserId)">
            <span class="material-icons">close</span><span>{{ 'profile.friends.request-decline' | translate }}</span>
          </button>
          <button (click)="acceptRequest(notification.actionUserId)">
            <span class="material-icons">done</span><span>{{ 'profile.friends.request-accept' | translate }}</span>
          </button>
        </div>
      </mat-expansion-panel>
    </mat-accordion>
    <div
      infinite-scroll
      [infiniteScrollDistance]="0"
      [infiniteScrollThrottle]="100"
      (scrolled)="onScroll()"
      [infiniteScrollDisabled]="!hasNextPage"
    ></div>
  </div>
  <app-spinner
    *ngIf="isLoading"
    infiniteScroll
    [infiniteScrollDistance]="0"
    [infiniteScrollThrottle]="500"
    (scrolled)="onScroll()"
  ></app-spinner>
</div>
