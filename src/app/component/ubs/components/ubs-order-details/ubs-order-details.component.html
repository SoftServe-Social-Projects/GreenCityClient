<div class="container">
  <div class="header">
    <h3>Послуги</h3>
    <p>Зверніть, будь ласка, увагу на те, що мінімальна сума замовлення має складати 500 грн.</p>
  </div>
  <form class="form" [formGroup]="orderDetailsForm" (ngSubmit)="submit()">
    <div class="w-100 d-flex justify-content-between">
      <label class="col-12 col-sm-3">Послуга</label>
      <label class="col-12 col-sm-2">Об'єм</label>
      <label class="col-12 col-sm-2">Вартість</label>
      <label class="col-12 col-sm-2">Кількість пакетів</label>
      <label class="col-12 col-sm-2">Сума</label>
    </div>
    <div class="main">
      <div class="col-12 col-sm-3 form-group">
        <input formControlName="bagServiceUbs" class="form-control">
      </div>
      <div class="col-12 col-sm-2 form-group">
        <input formControlName="bagSizeUbs" class="form-control">
      </div>
      <div class="col-12 col-sm-2 form-group">
        <input formControlName="bagPriceUbs" class="form-control">
      </div>
      <div class="col-12 col-sm-2 form-group count">
        <input formControlName="bagNumUbs"
               type="number"
               class="shadow-none form-control"
               [class.is-invalid]="bagNumUbs.invalid && bagNumUbs.touched"
               min="0"
               max="999"
               (click)="calculate()">
      </div>
      <div class="form-group sum">
        <input formControlName="bagSumUbs" type="text" class="form-control">
      </div>
      <div class="col-12 col-sm-3 form-group">
        <input formControlName="bagServiceClothesXL" class="form-control">
      </div>
      <div class="col-12 col-sm-2 form-group">
        <input formControlName="bagSizeClothesXL" type="text" class="form-control">
      </div>
      <div class="col-12 col-sm-2 form-group">
        <input formControlName="bagPriceClothesXL" type="text" class="form-control">
      </div>
      <div class="col-12 col-sm-2 form-group count">
        <input formControlName="bagNumClothesXL" type="number" min="0" class="shadow-none form-control" max="999"
          (click)="calculate()">
      </div>
      <div class="form-group sum">
        <input formControlName="bagSumClothesXL" type="text" class="form-control">
      </div>
      <div class="col-12 col-sm-3 form-group">
        <input formControlName="bagServiceClothesM" type="text" class="form-control">
      </div>
      <div class="col-12 col-sm-2 form-group">
        <input formControlName="bagSizeClothesM" type="text" class="form-control">
      </div>
      <div class="col-12 col-sm-2 form-group">
        <input formControlName="bagPriceClothesM" type="text" class="form-control">
      </div>
      <div class="col-12 col-sm-2 form-group count">
        <input formControlName="bagNumClothesM" type="number" class="shadow-none form-control" min="0" max="999"
          (click)="calculate()">
      </div>
      <div class="form-group sum">
        <input formControlName="bagSumClothesM" type="text" class="form-control">
      </div>
    </div>
    <div class="middle">
      <div class="middle-container">
        <div class="showTotal">
          <div class="totalInfo">
            <p [class.d-none]="showTotal === 0"><span>Сума замовлення: </span><span><b>{{ showTotal }} грн</b></span></p>
            <p *ngIf="displayCert"><span>Сертифікат: </span><span><small>-{{ showCertificateUsed }} грн</small></span></p>
            <p [class.d-none]="pointsUsed === 0"><span>Бонуси: </span><span><small>-{{ pointsUsed }} грн</small></span></p>
            <p><span>Сума до оплати: </span><span><b>{{ finalSum }} грн</b></span></p>
            <div *ngIf="displayMes" class="validMes">
              <small class="text-danger">Мінімальна сума замовлення повинна складати 500 грн</small>
            </div>
          </div>
        </div>
        <h5>Чи бажаєте Ви скористатись сертифікатом?</h5>
        <div class="certificate-container">
          <div class="form-group col-12 col-sm-8">
            <label>Введіть номер сертифіката</label>
            <input formControlName="certificate"
                   type="text"
                   class="shadow-none form-control"
                   placeholder="xxxx-xxxx"
                   [unmask]="false"
                   [imask]="{mask: certificateMask}">
          </div>
          <div class="form-group">
            <button *ngIf="!addCert" type="button" class="primary-global-button btn"
              [disabled]="!certificate.valid || certificate.pristine || finalSum === 0"
              (click)="certificateSubmit()">Активувати</button>
            <button *ngIf="addCert" type="button" class="primary-global-button btn"
              (click)="certificateReset()">Відмінити</button>
          </div>
          <div class="validMes">
            <small class="text-danger"
              *ngIf="certificate.invalid && certificate.touched">
              Сертифікат не прийнято, споробуйте ще раз</small>
            <small class="text-message"> {{ certMessage }} </small>
          </div>
          <small *ngIf="certSize">Сертифікат на суму {{ certificateSum }} грн активовано, що перевищує суму Вашого
            замовлення. Залишок у розмірі {{ certificateLeft }} грн
            буде нараховано на Ваш бонусний рахунок для наступного замовлення.</small>
        </div>
        <div class="addCertificate" formArrayName="additionalCertificates"
          *ngFor="let certificate of additionalCertificates.controls; let i=index;">
          <input type="text" class="shadow-none form-control col-12 col-sm-8 my-1" type="text" placeholder="xxxx-xxxx"
            [unmask]="false" [imask]="{mask: certificateMask}" [formControlName]="i">
          <div class="form-group">
            <button *ngIf="!addCert" type="button" class="primary-global-button btn"
              [disabled]="additionalCertificates['controls'][i].invalid || additionalCertificates['controls'][i].pristine"
              (click)="addedCertificateSubmit(i)">Активувати</button>
            <button *ngIf="addCert" type="button" class="primary-global-button btn"
              (click)="deleteCertificate(i)">Відмінити</button>
          </div>
          <div class="validMes">
            <small class="text-danger"
                   *ngIf="certificate.invalid && certificate.touched">
              Сертифікат не прийнято, споробуйте ще раз
            </small>
            <small class="text-message"> {{ certMessage }} </small>
          </div>
        </div>
        <button *ngIf="addCert" class="addCertificateBtn" (click)="addCertificate()">Додати ще сертифікат</button>
        <div class="addBonus">
          <h5>Чи бажаєте Ви скористатися бонусами?</h5>
          <p>На Вашому бонусному рахунку: {{ points }} грн</p>
          <div class="form-check custom-control custom-radio">
            <input formControlName="bonus" id="customRadio1" value="yes" class="form-check-input custom-control-input"
              type="radio" (click)="calculatePoints()">
            <label class="form-check-label custom-control-label" for="customRadio1">Так</label>
          </div>
          <div class="form-check custom-control custom-radio">
            <input formControlName="bonus" id="customRadio2" value="no" class="form-check-input custom-control-input"
              type="radio" (click)="resetPoints()">
            <label class="form-check-label custom-control-label" for="customRadio2">Ні</label>
          </div>
          <small class="text-message" [class.d-none]="pointsUsed === 0"><span>Використано {{ pointsUsed }}
              грн</span><br><span>Залишилось {{ points }} грн</span></small>
        </div>
      </div>
    </div>
    <div class="bottom">
      <h3>Еко магазин</h3>
      <h5>Чи чекаєте Ви замовлення з нашого Еко-магазину?</h5>
      <div class="form-check custom-control custom-radio">
        <input formControlName="shop" id="customRadio3" value="yes" class="form-check-input custom-control-input"
          type="radio">
        <label class="form-check-label custom-control-label" for="customRadio3">Так</label>
      </div>
      <div class="form-check custom-control custom-radio">
        <input formControlName="shop" id="customRadio4" value="no" class="form-check-input custom-control-input"
          type="radio">
        <label class="form-check-label custom-control-label" for="customRadio4">Ні</label>
      </div>
      <div class="form-group shop_submit">
        <div class="bottom-text">
          <p>Якщо Ви не змогли знайти номер замовлення, вкажіть в коментарі прізвище та ім’я, на які робили замовлення.
          </p>
        </div>
        <div formArrayName="additionalOrders" *ngFor="let order of additionalOrders.controls; let i=index"
          class="form-group">
          <label>Введіть номер замовлення</label>
          <input [formControlName]="i" class="shadow-none form-control" type="text" placeholder="xxxxxxxxxx">
        </div>
        <button *ngIf="additionalOrders.controls.length < 5" class="addOrderBtn" (click)="addOrder()">Додати ще номер
          замовлення</button>
      </div>
    </div>
    <div class="bottom_comment">
      <div class="form-group comment">
        <h3>Коментар</h3>
        <textarea formControlName="orderComment" class="shadow-none form-control" rows="5"
          placeholder="Будь-які деталі які Ви б хотіли повідомити додатково щодо цього замовлення"></textarea>
      </div>
      <div class="w-100 d-flex justify-content-end">
        <div>
        <button class="secondary-global-button btn" matStepperPrevious>Відмінити</button>
        <button type="submit" class="primary-global-button btn" matStepperNext [disabled]="onSubmit">Далі</button>
      </div>
      </div>
    </div>
  </form>
</div>
